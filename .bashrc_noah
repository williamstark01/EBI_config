# vim: set filetype=sh :

# William Stark (william@ebi.ac.uk)


# verify running in the EBI / Noah cluster
if [[ $LSF_ENVDIR != "/ebi/lsf/ebi/conf" ]]; then
    echo "This configuration is meant to be used on the Noah cluster, exiting."
    kill -INT $$
fi


# (try to) fix EBI cluster / brew / tmux issue:
# """
# Package bash-completion was not found in the pkg-config search path.
# Perhaps you should add the directory containing `bash-completion.pc'
# to the PKG_CONFIG_PATH environment variable
# No package 'bash-completion' found
# -bash: /yum: No such file or directory
# """
# https://github.com/Linuxbrew/legacy-linuxbrew/issues/46
export PKG_CONFIG_PATH="/usr/share/pkgconfig/"


# fix git plus pyenv issue
# https://github.com/pyenv/pyenv/issues/688
export GIT_INTERNAL_GETTEXT_TEST_FALLBACKS=1


export NFS_ROOT="/nfs/production/panda/ensembl/$USER"
export HPS_ROOT="/hps/nobackup2/production/ensembl/$USER"

alias nfs="cd $NFS_ROOT"
alias hps="cd $HPS_ROOT"

export ENSCODE="$NFS_ROOT/enscode"


if [[ -d $HOME/EBI_config/bin ]]; then
    export PATH="$HOME/EBI_config/bin:$PATH"
fi


alias bsub-shell="bsub -q production-rh74 -Is -tty $SHELL"


source "$HOME/data/programs/tmux-bash-completion/completions/tmux"


# https://www.ebi.ac.uk/seqdb/confluence/display/ENSGBD/Genebuild+virtual+user%2C+shared+environment+and+shared+data
################################################################################
export HIVE_EMAIL="$USER@ebi.ac.uk"
export GENEBUILDER_ID=50

#ensembl_version=$(mysql-ens-meta-prod-1 ensembl_metadata --skip-column-names --execute="SELECT ensembl_version FROM data_release WHERE is_current = 1;")
ENSEMBL_RELEASE="104"

# MySQL commands
# https://www.ebi.ac.uk/seqdb/confluence/display/ENS/MySQL+commands
if [[ -d /nfs/software/ensembl/mysql-cmds/ensembl/bin ]]; then
    export PATH="/nfs/software/ensembl/mysql-cmds/ensembl/bin:$PATH"
fi
################################################################################


load_homebrew() {
    ### Homebrew (Linuxbrew)
    # /nfs/software/ensembl/RHEL7-JUL2017-core2/envs/minimal.sh
    # /nfs/software/ensembl/RHEL7-JUL2017-core2/envs/linuxbrew.sh
    export ENSEMBL_SOFTWARE_HOME=/nfs/software/ensembl/RHEL7-JUL2017-core2

    export HOMEBREW_ENSEMBL_MOONSHINE_ARCHIVE=/nfs/software/ensembl/ENSEMBL_MOONSHINE_ARCHIVE
    export ENSEMBL_MOONSHINE_ARCHIVE=/nfs/software/ensembl/ENSEMBL_MOONSHINE_ARCHIVE

    export LINUXBREW_HOME=/nfs/software/ensembl/RHEL7-JUL2017-core2/linuxbrew
    export PATH="$LINUXBREW_HOME/bin:$LINUXBREW_HOME/sbin:$PATH"
    export MANPATH="$LINUXBREW_HOME/share/man:$MANPATH"
    export INFOPATH="$LINUXBREW_HOME/share/info:$INFOPATH"
    export HOMEBREW_FORCE_BREWED_CURL=1
}


### Python pyenv
PYENV_ROOT="$NFS_ROOT/.pyenv"
[[ -d "$PYENV_ROOT" ]] && export PYENV_ROOT

### Node.js nvm
NVM_DIR="$HOME/.nvm"
[[ -d "$NVM_DIR" ]] && export NVM_DIR

### Perl plenv
PLENV_ROOT="/nfs/software/ensembl/RHEL7-JUL2017-core2/plenv"
